---
output:
  html_document:
    css: Sebastian-styles1.css
    theme: null
    highlight: null
    self_contained: true
    toc: false
    df_print: kable
---


```{=html}
<script>
// Funci√≥n mejorada para mostrar/ocultar TODO el c√≥digo R
function toggleAllCode() {
  // Seleccionar TODOS los contenedores de c√≥digo que R Markdown genera
  var codeContainers = document.querySelectorAll('pre:not(.r-output), div.sourceCode pre');
  var button = document.querySelector('.floating-code-btn');
  
  if (!button || codeContainers.length === 0) {
    console.warn('No se encontraron bloques de c√≥digo o el bot√≥n');
    return;
  }
  
  var allHidden = true;
  
  // Verificar si alg√∫n c√≥digo est√° visible
  codeContainers.forEach(function(container) {
    if (container.style.display !== 'none') {
      allHidden = false;
    }
  });
  
  // Mostrar u ocultar todo el c√≥digo
  codeContainers.forEach(function(container) {
    if (allHidden) {
      container.style.display = 'block';
      container.classList.add('code-visible');
      // Animaci√≥n suave
      container.style.opacity = '0';
      setTimeout(function() {
        container.style.transition = 'opacity 0.3s ease';
        container.style.opacity = '1';
      }, 10);
    } else {
      container.style.transition = 'opacity 0.3s ease';
      container.style.opacity = '0';
      setTimeout(function() {
        container.style.display = 'none';
        container.classList.remove('code-visible');
      }, 300);
    }
  });
  
  // Cambiar texto del bot√≥n
  if (allHidden) {
    button.innerHTML = 'üìù Ocultar Todo el C√≥digo R';
  } else {
    button.innerHTML = 'üìù Mostrar Todo el C√≥digo R';
  }
}

// Ocultar c√≥digo al cargar la p√°gina - MEJORADO
window.addEventListener('load', function() {
  setTimeout(function() {
    var codeContainers = document.querySelectorAll('pre:not(.r-output), div.sourceCode pre');
    console.log('Bloques de c√≥digo encontrados:', codeContainers.length);
    
    codeContainers.forEach(function(container) {
      container.style.display = 'none';
      // Agregar clase para identificaci√≥n
      container.classList.add('r-code-block');
    });
    
    // Verificar que el bot√≥n existe
    var button = document.querySelector('.floating-code-btn');
    if (button) {
      console.log('Bot√≥n de toggle encontrado y funcional');
    } else {
      console.error('¬°Bot√≥n no encontrado!');
    }
  }, 500); // Aumentado el delay para asegurar que todo est√© cargado
});
</script>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.width = 7,
  fig.height = 4.5,
  out.width = "95%",
  class.source = "r-code-chunk",
  dev = "png",
  dpi = 120
)

library(ggplot2)
library(dplyr)
library(knitr)
library(kableExtra)
library(tibble)
library(showtext)
library(factoextra)

# Configurar fuentes financieras
font_add_google("Roboto", "Roboto")
font_add_google("Inter", "Inter")
font_add_google("Open Sans", "Open Sans")
showtext_auto()

options(kableExtra.html.bsTable = TRUE)

# =============================================================================
# TEMA GGPLOT2 PERSONALIZADO - TEMA iSHARES
# =============================================================================

theme_ishares <- function() {
  theme_minimal(base_size = 11) +
    theme(
      text = element_text(family = "Inter", size = 11, color = "#2E3842"),
      
      plot.title = element_text(
        family = "Roboto",
        size = 14,
        face = "bold", 
        hjust = 0.5,
        color = "#001A5C",
        margin = margin(b = 15)
      ),
      plot.subtitle = element_text(
        family = "Roboto",
        size = 12,
        hjust = 0.5,
        color = "#5D6D7E",
        margin = margin(b = 12)
      ),
      plot.caption = element_text(
        family = "Inter",
        size = 9,
        color = "#5D6D7E",
        hjust = 0.5,
        face = "italic",
        margin = margin(t = 10)
      ),
      
      axis.title = element_text(
        family = "Roboto",
        size = 11,
        face = "bold",
        color = "#0056B3"
      ),
      axis.title.x = element_text(margin = margin(t = 10)),
      axis.title.y = element_text(margin = margin(r = 10)),
      axis.text = element_text(
        family = "Inter",
        size = 10,
        color = "#5D6D7E",
        face = "plain"
      ),
      axis.line = element_line(color = "#0056B3", linewidth = 0.5),
      axis.ticks = element_line(color = "#007BFF", linewidth = 0.3),
      
      legend.title = element_text(
        family = "Roboto",
        size = 11,
        face = "bold",
        color = "#001A5C"
      ),
      legend.text = element_text(
        family = "Inter", 
        size = 10,
        color = "#5D6D7E"
      ),
      legend.background = element_rect(fill = "#F5F7FA", color = "#D1D8E0"),
      legend.key = element_rect(fill = "#F5F7FA", color = NA),
      
      panel.grid.major = element_line(
        color = "#E8ECF1", 
        linewidth = 0.5,
        linetype = "solid"
      ),
      panel.grid.minor = element_line(
        color = "#F5F7FA", 
        linewidth = 0.3,
        linetype = "solid"
      ),
      panel.background = element_rect(fill = "white", color = NA),
      plot.background = element_rect(fill = "white", color = NA),
      
      plot.margin = margin(15, 15, 15, 15),
      panel.spacing = unit(1.5, "lines"),
      
      strip.background = element_rect(
        fill = "#0056B3",
        color = "#0056B3",
        linewidth = 1
      ),
      strip.text = element_text(
        family = "Roboto",
        color = "white",
        face = "bold",
        size = 11
      )
    )
}

# ‚≠ê APLICAR EL TEMA iSHARES AUTOM√ÅTICAMENTE A GGPLOT2
theme_set(theme_ishares())

# =============================================================================
# FUNCI√ìN WRAPPER PARA FACTOEXTRA - VERSI√ìN iSHARES
# =============================================================================

fviz_eig_ishares <- function(...) {
  p <- fviz_eig(..., ggtheme = theme_void())
  p + theme_ishares()
}

fviz_pca_ishares <- function(...) {
  p <- fviz_pca(..., ggtheme = theme_void())
  p + theme_ishares()
}

fviz_pca_ind_ishares <- function(...) {
  p <- fviz_pca_ind(..., ggtheme = theme_void())
  p + theme_ishares()
}

fviz_pca_var_ishares <- function(...) {
  p <- fviz_pca_var(..., ggtheme = theme_void())
  p + theme_ishares()
}

fviz_pca_biplot_ishares <- function(...) {
  p <- fviz_pca_biplot(..., ggtheme = theme_void())
  p + theme_ishares()
}

fviz_dend_ishares <- function(...) {
  p <- fviz_dend(..., ggtheme = theme_void())
  p + theme_ishares()
}

fviz_cluster_ishares <- function(...) {
  p <- fviz_cluster(..., ggtheme = theme_void())
  p + theme_ishares()
}

# =============================================================================
# PALETA DE COLORES iSHARES
# =============================================================================

colores_ishares <- c(
  "#001A5C",  # Azul oscuro iShares
  "#0056B3",  # Azul medio
  "#007BFF",  # Azul claro
  "#00B0F0",  # Cian
  "#2E3842",  # Gris oscuro
  "#5D6D7E",  # Gris medio
  "#00A859",  # Verde para positivos
  "#E74C3C",  # Rojo para negativos
  "#D4AF37",  # Dorado para destacados
  "#A6ACB5"   # Plata para elementos secundarios
)

scale_color_ishares <- function(palette = colores_ishares, ...) {
  scale_color_manual(values = palette, ...)
}

scale_fill_ishares <- function(palette = colores_ishares, ...) {
  scale_fill_manual(values = palette, ...)
}

scale_fill_gradient_ishares <- function(low = "#00B0F0", high = "#001A5C", ...) {
  scale_fill_gradient(low = low, high = high, ...)
}

scale_color_gradient_ishares <- function(low = "#00B0F0", high = "#001A5C", ...) {
  scale_color_gradient(low = low, high = high, ...)
}

# =============================================================================
# FUNCIONES PARA INDICADORES FINANCIEROS
# =============================================================================

# Funci√≥n para mostrar cambios de precio
format_price_change <- function(value) {
  if (value >= 0) {
    sprintf("<span style='color:#00A859;font-weight:bold;'>+%.2f%%</span>", value)
  } else {
    sprintf("<span style='color:#E74C3C;font-weight:bold;'>%.2f%%</span>", value)
  }
}

# Funci√≥n para colores condicionales en tablas
colorize_cell <- function(value, type = "return") {
  if (type == "return") {
    if (value >= 0) {
      kableExtra::cell_spec(value, color = "#00A859", bold = TRUE)
    } else {
      kableExtra::cell_spec(value, color = "#E74C3C", bold = TRUE)
    }
  } else if (type == "volume") {
    kableExtra::cell_spec(value, color = "#0056B3", bold = FALSE)
  } else {
    kableExtra::cell_spec(value, color = "#2E3842", bold = FALSE)
  }
}

# =============================================================================
# SOBRESCRIBIR KABLE PARA AUTO-ESTILIZADO CON TEMA iSHARES
# =============================================================================

kable_original <- knitr::kable

kable <- function(x, format = "html", ..., 
                  bootstrap_options = c("striped", "hover", "condensed"),
                  full_width = TRUE,
                  position = "center",
                  financial_table = FALSE) {
  
  if (inherits(x, "knitr_kable")) {
    return(x)
  }
  
  if (financial_table) {
    # Estilo especial para tablas financieras
    tabla <- kable_original(x, format = format, ...) %>%
      kable_styling(
        bootstrap_options = c("striped", "hover", "condensed", "responsive"),
        full_width = full_width,
        position = position,
        font_size = 13,
        html_font = "Inter, 'Segoe UI', sans-serif"
      ) %>%
      row_spec(0, 
               bold = TRUE, 
               background = "linear-gradient(135deg, #001A5C 0%, #0056B3 100%)",
               color = "white",
               font_size = 14,
               align = "c") %>%
      row_spec(1:nrow(x), 
               extra_css = "transition: background-color 0.3s;") %>%
      column_spec(1, bold = TRUE, color = "#001A5C")
  } else {
    # Estilo est√°ndar
    tabla <- kable_original(x, format = format, ...) %>%
      kable_styling(
        bootstrap_options = bootstrap_options,
        full_width = full_width,
        position = position,
        font_size = 13,
        html_font = "Inter, 'Segoe UI', sans-serif"
      ) %>%
      row_spec(0, 
               bold = TRUE, 
               background = "#001A5C",
               color = "white",
               font_size = 14)
  }
  
  return(tabla)
}

kbl_original <- kableExtra::kbl

kbl <- function(x, format = "html", ..., financial = FALSE) {
  if (financial) {
    tabla <- kbl_original(x, format = format, ...) %>%
      kable_styling(
        bootstrap_options = c("striped", "hover", "condensed", "responsive"),
        full_width = TRUE,
        position = "center",
        font_size = 13,
        html_font = "Inter, 'Segoe UI', sans-serif"
      ) %>%
      row_spec(0, 
               bold = TRUE, 
               background = "linear-gradient(135deg, #001A5C 0%, #0056B3 100%)",
               color = "white",
               font_size = 14) %>%
      column_spec(1, bold = TRUE, color = "#001A5C")
  } else {
    tabla <- kbl_original(x, format = format, ...) %>%
      kable_styling(
        bootstrap_options = c("striped", "hover", "condensed"),
        full_width = TRUE,
        position = "center",
        font_size = 13,
        html_font = "Inter, 'Segoe UI', sans-serif"
      ) %>%
      row_spec(0, 
               bold = TRUE, 
               background = "#001A5C",
               color = "white",
               font_size = 14)
  }
  
  return(tabla)
}

# =============================================================================
# FUNCIONES ADICIONALES PARA AN√ÅLISIS FINANCIERO
# =============================================================================

# Calculadora de rendimientos
calculate_returns <- function(prices, period = "daily") {
  returns <- diff(prices) / prices[-length(prices)]
  
  if (period == "annual") {
    returns <- returns * 252  # D√≠as de trading anuales
  } else if (period == "monthly") {
    returns <- returns * 21   # D√≠as de trading mensuales
  }
  
  return(returns)
}

# M√©tricas de riesgo
calculate_risk_metrics <- function(returns) {
  list(
    mean_return = mean(returns, na.rm = TRUE),
    sd_return = sd(returns, na.rm = TRUE),
    sharpe_ratio = ifelse(sd(returns, na.rm = TRUE) > 0, 
                          mean(returns, na.rm = TRUE) / sd(returns, na.rm = TRUE), 
                          NA),
    max_drawdown = min(returns, na.rm = TRUE)
  )
}


format_financial <- function(x, type = "price") {
  if (type == "price") {
    scales::dollar(x, accuracy = 0.01)
  } else if (type == "percent") {
    scales::percent(x, accuracy = 0.01)
  } else if (type == "volume") {
    if (x >= 1e9) {
      paste0(scales::comma(x/1e9, accuracy = 0.1), "B")
    } else if (x >= 1e6) {
      paste0(scales::comma(x/1e6, accuracy = 0.1), "M")
    } else {
      scales::comma(x)
    }
  }
}

theme_financial <- function() {
  theme_ishares() +
    theme(
      panel.grid.major.x = element_line(color = "#E8ECF1", linewidth = 0.3),
      panel.grid.major.y = element_line(color = "#E8ECF1", linewidth = 0.5),
      panel.grid.minor = element_blank(),
      plot.title = element_text(color = "#001A5C", size = 16, face = "bold"),
      axis.title = element_text(color = "#0056B3", size = 12),
      legend.position = "bottom",
      legend.box = "horizontal"
    )
}

# Funci√≥n para gr√°fico de velas (candlestick)
plot_candlestick <- function(data, title = "Candlestick Chart") {
  # data debe tener: Date, Open, High, Low, Close
  ggplot(data) +
    geom_linerange(aes(x = Date, ymin = Low, ymax = High), 
                   color = "#5D6D7E", linewidth = 0.5) +
    geom_rect(aes(xmin = Date - 0.45, xmax = Date + 0.45,
                  ymin = pmin(Open, Close), ymax = pmax(Open, Close),
                  fill = Close > Open), color = NA) +
    scale_fill_manual(values = c("#E74C3C", "#00A859"), guide = FALSE) +
    labs(title = title, x = "Fecha", y = "Precio") +
    theme_financial()
}

# =============================================================================
# INICIALIZACI√ìN PARA AN√ÅLISIS DE SERIES TEMPORALES
# =============================================================================

library(quantmod)
library(PerformanceAnalytics)
library(TTR)
library(xts)
library(zoo)

# Configurar opciones para series temporales financieras
options("getSymbols.warning4.0" = FALSE)
options("getSymbols.yahoo.warning" = FALSE)

# Funci√≥n para descargar datos de acciones
get_stock_data <- function(symbol, start_date = "2020-01-01", end_date = Sys.Date()) {
  getSymbols(symbol, 
             from = start_date, 
             to = end_date, 
             auto.assign = FALSE)
}

```
::::::::::::::::: container
<!-- SIDEBAR -->

:::: sidebar
::: sidebar-header
<img src="logo-ishares.png" alt="iShares by BlackRock" class="logo-ishares"/>

<h1>An√°lisis Financiero</h1>

<h2>iShares ETF Analysis</h2>
:::

<ul class="sidebar-nav">
<li><a href="#introduccion" class="active">[üìà]{.icon} Introducci√≥n</a></li>
<li><a href="#datos">[üìä]{.icon} Datos de Mercado</a></li>
<li><a href="#metodologia">[üîß]{.icon} Metodolog√≠a</a></li>
<li><a href="#analisis-tecnico">[üìâ]{.icon} An√°lisis T√©cnico</a></li>
<li><a href="#analisis-fundamental">[üíπ]{.icon} An√°lisis Fundamental</a></li>
<li><a href="#riesgos">[‚ö†Ô∏è]{.icon} Evaluaci√≥n de Riesgos</a></li>
<li><a href="#recomendaciones">[üí°]{.icon} Recomendaciones</a></li>
<li><a href="#bibliografia">[üìö]{.icon} Bibliograf√≠a</a></li>
</ul>
::::

<!-- CONTENIDO PRINCIPAL -->

:::::::::::::: main-content
<!-- ENCABEZADO -->

::: main-header
<h1>Segmentaci√≥n de Pa√≠ses mediante Indicadores de Mortalidad</h1>

<h2>**An√°lisis de t√©cnicas de Aprendizaje No Supervisado - Banco Mundial**</h2>

<h3>Universidad del Valle - Facultad de Ingenier√≠a</h3>

<h4>Melany Enriquez - Santiago Posada - Sofia Potosi - Valery Rivera</h4>
:::

<!-- RESUMEN EJECUTIVO -->

::: {#resumen .content-card}
<h2>Resumen</h2>

<p>*Este estudio aplica t√©cnicas de aprendizaje no supervisado para identificar patrones naturales de agrupaci√≥n entre pa√≠ses bas√°ndose en 22 indicadores de mortalidad del Banco Mundial correspondientes al a√±o 2019. Se emple√≥ An√°lisis de Componentes Principales (ACP) para reducir la dimensionalidad del conjunto de datos, seguido de clusterizaci√≥n jer√°rquica mediante el m√©todo de Ward para identificar segmentos de pa√≠ses con perfiles de mortalidad similares. Los indicadores analizados incluyen expectativa de vida por sexo, mortalidad por enfermedades cr√≥nicas, mortalidad por causas externas (accidentes de tr√°nsito, envenenamientos, suicidios), mortalidad infantil y neonatal desagregada por sexo, y supervivencia hasta los 65 a√±os. Los resultados permitieron identificar grupos de pa√≠ses con caracter√≠sticas de mortalidad homog√©neas internamente pero diferenciadas entre s√≠, proporcionando informaci√≥n para la formulaci√≥n de pol√≠ticas de salud p√∫blica basadas en evidencia.*</p>
:::

<!-- INTRODUCCI√ìN -->

::: {#introduccion .content-card}
<h2>Introducci√≥n</h2>

<p>La mortalidad constituye uno de los indicadores fundamentales para evaluar el estado de salud de las poblaciones y la efectividad de los sistemas sanitarios a nivel global. Los patrones de mortalidad reflejan diferencias significativas entre naciones, resultado de factores como acceso a servicios de salud, nivel de desarrollo econ√≥mico, infraestructura sanitaria, calidad de la atenci√≥n materno-infantil y magnitud de determinantes sociales. Estas variaciones no son √∫nicamente atribuibles a regiones geogr√°ficas o niveles de ingresos, sino que responden a din√°micas epidemiol√≥gicas complejas que estructuran la carga de enfermedad de formas distintas en cada contexto nacional.</p>

<p>Actualmente, la clasificaci√≥n de pa√≠ses para fines de pol√≠tica sanitaria se realiza mediante categor√≠as predefinidas basadas en criterios geogr√°ficos o econ√≥micos. Sin embargo, estas clasificaciones convencionales no necesariamente capturan las similitudes reales en los perfiles epidemiol√≥gicos entre naciones. Existe una desalineaci√≥n entre las agrupaciones administrativas que utilizamos para organizar datos internacionales y la realidad de los patrones de mortalidad que los pa√≠ses efectivamente experimentan. Esto implica que una segmentaci√≥n basada emp√≠ricamente en los propios datos de mortalidad podr√≠a revelar qu√© pa√≠ses enfrentan desaf√≠os sanitarios comparables, independientemente de sus caracter√≠sticas tradicionales, facilitando intercambio de experiencias y estrategias relevantes entre contextos similares.</p>

<p>Las t√©cnicas de aprendizaje no supervisado permiten identificar estas estructuras naturales sin imponer categor√≠as predeterminadas. El An√°lisis de Componentes Principales sintetiza m√∫ltiples indicadores correlacionados en dimensiones fundamentales que explican la variabilidad en mortalidad entre pa√≠ses. La clusterizaci√≥n jer√°rquica subsecuente agrupa naciones seg√∫n similitud en estas dimensiones, produciendo segmentaciones coherentes que reflejan realidades epidemiol√≥gicas.</p>

<p>El objetivo de este estudio es aplicar estas t√©cnicas para segmentar 182 pa√≠ses seg√∫n 22 indicadores de mortalidad del a√±o 2019, identificando grupos de naciones con perfiles epidemiol√≥gicos similares. Se espera que los clusters resultantes revelen patrones de mortalidad que trascienden categor√≠as convencionales, faciliten la caracterizaci√≥n de inequidades de g√©nero, y proporcionen una base emp√≠rica para el dise√±o de pol√≠ticas de salud p√∫blica diferenciadas seg√∫n contextos epidemiol√≥gicos reales.</p>
:::

<!-- DESCRIPCION DE LA FUENTE DE DATOS -->

::: {#descripcionf .content-card}
<h2>Descripci√≥n de la fuente de Datos</h2>

<p>

**Base de datos:** World Development Indicators (WDI) - Banco Mundial

**Unidad de an√°lisis:** Pa√≠s

**Per√≠odo:** 2019

**Acceso:** <https://databank.worldbank.org/source/world-development-indicators>

</p>

<p>Los datos utilizados en esta investigaci√≥n provienen de la base World Development Indicators del Banco Mundial, una de las compilaciones m√°s exhaustivas de indicadores de desarrollo compilados a partir de fuentes internacionales estandarizadas. Esta base integra informaci√≥n de organismos especializados reconocidos mundialmente, incluyendo la Organizaci√≥n Mundial de la Salud (OMS), UNICEF y agencias especializadas de las Naciones Unidas, garantizando comparabilidad metodol√≥gica entre pa√≠ses y confiabilidad en la medici√≥n de indicadores. El a√±o 2019 fue seleccionado como period

<!-- ... resto del contenido ... -->

<!-- FOOTER -->

::: footer
<p>Universidad del Valle - Facultad de Ingenier√≠a</p>

<p>Gesti√≥n de Datos - Profesor: Orlando Joaqui Barandica</p>

<p>Fecha: `r format(Sys.Date(), "%d/%m/%Y")`</p>
:::
::::::::::::::
::::::::::::::::::

<!-- BOT√ìN FLOTANTE ELEGANTE -->

<button class="floating-code-btn" onclick="toggleAllCode()">

üìù Mostrar Todo el C√≥digo

</button>